<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIFA Collect Ticket Tracker</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #09090b; /* Zinc 950 */
            color: #ffffff;
        }
        .font-oswald {
            font-family: 'Oswald', sans-serif;
        }
        /* Custom scrollbar for table container */
        .overflow-x-auto::-webkit-scrollbar {
            height: 8px;
        }
        .overflow-x-auto::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }
        .overflow-x-auto::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }
        .overflow-x-auto::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body class="min-h-screen">

<div class="pt-10 pb-20">
    <div class="max-w-[1600px] mx-auto px-4">
        
        <!-- Header Section -->
        <div class="flex flex-col md:flex-row justify-between items-end mb-10 border-b border-white/10 pb-8">
            <div>
                <div class="flex items-center gap-3 mb-2">
                    <span class="bg-emerald-500/20 text-emerald-400 px-3 py-1 rounded text-xs font-bold uppercase tracking-wider border border-emerald-500/30">Beta</span>
                    <h1 class="text-4xl md:text-6xl font-bold font-oswald text-white">FIFA COLLECT TICKET TRACKER</h1>
                </div>
                <p class="text-gray-400 max-w-2xl text-lg">
                    Monitor real-time "Right to Ticket" token prices. Filter by team, city, or budget to find potential deals for 2026.
                </p>
            </div>
            <div class="mt-6 md:mt-0">
                <a href="#" class="flex items-center gap-2 text-emerald-400 hover:text-white transition font-bold uppercase tracking-widest text-sm">
                    View Official Marketplace <i data-lucide="arrow-up-right" class="w-4 h-4"></i>
                </a>
            </div>
        </div>

        <!-- Filters Section -->
        <div class="bg-white/5 border border-white/10 rounded-xl p-4 mb-8">
            <!-- UPDATED: Grid adapted for mobile (1 col -> 2 col -> 3 col -> 6 col) -->
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                <div>
                    <label class="block text-xs uppercase font-bold text-gray-500 mb-1">Match #</label>
                    <input type="text" id="filter-match-no" data-filter-type="match" class="ticket-filter w-full bg-black border border-white/20 text-white rounded px-3 py-2 text-sm focus:border-emerald-500 outline-none" placeholder="e.g. 104">
                </div>

                <div>
                    <label class="block text-xs uppercase font-bold text-gray-500 mb-1">City</label>
                    <select id="filter-city" data-filter-type="city" class="ticket-filter w-full bg-black border border-white/20 text-white rounded px-3 py-2 text-sm focus:border-emerald-500 outline-none">
                        <option value="">All</option>
                    </select>
                </div>

                <div>
                    <label class="block text-xs uppercase font-bold text-gray-500 mb-1">Team</label>
                    <select id="filter-team" data-filter-type="team" class="ticket-filter w-full bg-black border border-white/20 text-white rounded px-3 py-2 text-sm focus:border-emerald-500 outline-none">
                        <option value="">All</option>
                    </select>
                </div>

                <div>
                    <label class="block text-xs uppercase font-bold text-gray-500 mb-1">Round</label>
                    <select id="filter-round" data-filter-type="round" class="ticket-filter w-full bg-black border border-white/20 text-white rounded px-3 py-2 text-sm focus:border-emerald-500 outline-none">
                        <option value="">All</option>
                    </select>
                </div>

                <div>
                    <label class="block text-xs uppercase font-bold text-gray-500 mb-1">Category</label>
                    <select id="filter-category" data-filter-type="category" class="ticket-filter w-full bg-black border border-white/20 text-white rounded px-3 py-2 text-sm focus:border-emerald-500 outline-none">
                        <option value="">All</option>
                    </select>
                </div>
                
                 <!-- Moved Sort to main grid on mobile/tablet for better access, or keep in footer -->
                 <div class="sm:col-span-2 md:col-span-1">
                    <label class="block text-xs uppercase font-bold text-gray-500 mb-1">Sort By</label>
                    <select id="ticket-sort-select" class="w-full bg-black border border-white/20 text-white rounded px-3 py-2 text-sm focus:border-emerald-500 outline-none">
                        <option value="matchNo">Match Number</option>
                        <option value="priceAsc">Lowest Price</option>
                        <option value="priceDesc">Highest Price</option>
                    </select>
                </div>
            </div>

            <div class="flex justify-between items-center mt-4 pt-4 border-t border-white/10">
                <div class="text-sm text-emerald-400 font-mono font-bold" id="ticket-count">Loading...</div>
                <div class="text-xs text-gray-500 uppercase tracking-widest hidden sm:block">
                    Live Data Preview
                </div>
            </div>
        </div>

        <!-- Table / List Section -->
        <div class="bg-transparent md:bg-white/5 md:border md:border-white/10 md:rounded-xl md:overflow-hidden">
            <div class="md:overflow-x-auto">
                <table class="w-full text-left border-collapse min-w-full md:min-w-[1000px]">
                    <!-- UPDATED: Hidden on mobile -->
                    <thead class="hidden md:table-header-group">
                        <tr class="bg-white/5 text-xs uppercase tracking-widest text-gray-500 border-b border-white/10">
                            <th class="p-4 font-bold">No.</th>
                            <th class="p-4 font-bold">Match</th>
                            <th class="p-4 font-bold">Location</th>
                            <th class="p-4 font-bold">Round</th>
                            <th class="p-4 font-bold">Cat</th>
                            <th class="p-4 font-bold">Starting At</th>
                        </tr>
                    </thead>
                    <tbody id="ticket-table-body" class="text-sm block md:table-row-group">
                        <!-- Content injected via JS -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <p class="text-center text-gray-600 text-xs mt-8 uppercase tracking-widest">
            * Data is mocked for demonstration. Prices do not reflect real-time market values. <br>
            Not affiliated with FIFA.
        </p>

    </div>
</div>

<script>
/**
 * TICKET ENGINE
 */
const TicketEngine = {
    listings: [],
    // Pointing to a dummy file to force the catch block to run and generate mock data
    apiEndpoint: './data/live-listings-dummy.json', 
    
    // FULL SCHEDULE MAPPING
    matchSchedule: {
        // GROUP A
        1: ["Mexico", "South Africa"], 2: ["Korea Republic", "Winner Play-off D"],
        25: ["Winner Play-off D", "South Africa"], 28: ["Mexico", "Korea Republic"],
        53: ["Winner Play-off D", "Mexico"], 54: ["South Africa", "Korea Republic"],
        // GROUP B
        3: ["Canada", "Winner Play-off A"], 8: ["Qatar", "Switzerland"],
        26: ["Switzerland", "Winner Play-off A"], 27: ["Canada", "Qatar"],
        51: ["Switzerland", "Canada"], 52: ["Winner Play-off A", "Qatar"],
        // GROUP C
        5: ["Brazil", "Morocco"], 7: ["Haiti", "Scotland"],
        29: ["Scotland", "Morocco"], 30: ["Brazil", "Haiti"],
        49: ["Scotland", "Brazil"], 50: ["Morocco", "Haiti"],
        // GROUP D
        4: ["USA", "Paraguay"], 6: ["Australia", "Winner Play-off C"],
        31: ["Winner Play-off C", "Paraguay"], 32: ["USA", "Australia"],
        59: ["Winner Play-off C", "USA"], 60: ["Paraguay", "Australia"],
        // GROUP E
        9: ["Côte d'Ivoire", "Ecuador"], 10: ["Germany", "Curaçao"],
        33: ["Germany", "Côte d'Ivoire"], 34: ["Ecuador", "Curaçao"],
        55: ["Ecuador", "Germany"], 56: ["Curaçao", "Côte d'Ivoire"],
        // GROUP F
        11: ["Netherlands", "Japan"], 12: ["Winner Play-off B", "Tunisia"],
        35: ["Netherlands", "Winner Play-off B"], 36: ["Tunisia", "Japan"],
        57: ["Japan", "Winner Play-off B"], 58: ["Tunisia", "Netherlands"],
        // GROUP G
        15: ["IR Iran", "New Zealand"], 16: ["Belgium", "Egypt"],
        39: ["Belgium", "IR Iran"], 40: ["New Zealand", "Egypt"],
        63: ["Egypt", "IR Iran"], 64: ["New Zealand", "Belgium"],
        // GROUP H
        13: ["Saudi Arabia", "Uruguay"], 14: ["Spain", "Cabo Verde"],
        37: ["Uruguay", "Cabo Verde"], 38: ["Spain", "Saudi Arabia"],
        65: ["Cabo Verde", "Saudi Arabia"], 66: ["Uruguay", "Spain"],
        // GROUP I
        17: ["France", "Senegal"], 18: ["Winner Play-off 2", "Norway"],
        41: ["France", "Winner Play-off 2"], 42: ["Norway", "Senegal"],
        61: ["Norway", "France"], 62: ["Senegal", "Winner Play-off 2"],
        // GROUP J
        19: ["Argentina", "Algeria"], 20: ["Austria", "Jordan"],
        43: ["Argentina", "Austria"], 44: ["Jordan", "Algeria"],
        69: ["Algeria", "Austria"], 70: ["Jordan", "Argentina"],
        // GROUP K
        23: ["Portugal", "Winner Play-off 1"], 24: ["Uzbekistan", "Colombia"],
        47: ["Portugal", "Uzbekistan"], 48: ["Colombia", "Winner Play-off 1"],
        71: ["Colombia", "Portugal"], 72: ["Winner Play-off 1", "Uzbekistan"],
        // GROUP L
        21: ["Ghana", "Panama"], 22: ["England", "Croatia"],
        45: ["England", "Ghana"], 46: ["Panama", "Croatia"],
        67: ["Panama", "England"], 68: ["Croatia", "Ghana"]
    },

    state: {
        loading: false,
        error: null,
        filter: { match: '', city: '', team: '', round: '', category: '' },
        sort: 'matchNo',
    },

    init: async () => {
        // Initialize Lucide icons
        if(window.lucide) window.lucide.createIcons();
        
        await TicketEngine.fetchListings();
        TicketEngine.populateFilters();
        TicketEngine.render();
        
        document.querySelectorAll('.ticket-filter').forEach(el => {
            const eventType = el.tagName === 'INPUT' ? 'input' : 'change';
            el.addEventListener(eventType, (e) => {
                TicketEngine.state.filter[e.target.dataset.filterType] = e.target.value;
                TicketEngine.render();
            });
        });

        const sortSelect = document.getElementById('ticket-sort-select');
        if(sortSelect) {
            sortSelect.addEventListener('change', (e) => {
                TicketEngine.state.sort = e.target.value;
                TicketEngine.render();
            });
        }
    },

    fetchListings: async () => {
        TicketEngine.state.loading = true;
        TicketEngine.renderLoadingState();

        try {
            // Attempt fetch, but likely fall to catch block in this demo environment
            const response = await fetch(`${TicketEngine.apiEndpoint}?t=${new Date().getTime()}`);
            if (!response.ok) throw new Error(`Data not found`);
            const rawData = await response.json();
            // ... (Data processing logic from original file omitted for brevity since we use mock) ...
        } catch (error) {
            console.warn("TicketEngine: Generating mock data for preview");
            TicketEngine.generateMockData();
        } finally {
            TicketEngine.state.loading = false;
            TicketEngine.render();
        }
    },

    generateMockData: () => {
        // Generating robust mock data for the preview
        const mockMatches = [
            { id: 104, city: "New York New Jersey", round: "Final", teams: ["TBD", "TBD"], price: 1250 },
            { id: 1, city: "Mexico City", round: "Group Stage", teams: ["Mexico", "South Africa"], price: 180 },
            { id: 4, city: "Los Angeles", round: "Group Stage", teams: ["USA", "Paraguay"], price: 250 },
            { id: 48, city: "Dallas", round: "Group Stage", teams: ["Colombia", "Winner Play-off 1"], price: 145 },
            { id: 22, city: "Philadelphia", round: "Group Stage", teams: ["England", "Croatia"], price: 320 },
            { id: 5, city: "Boston", round: "Group Stage", teams: ["Brazil", "Morocco"], price: 400 },
            { id: 72, city: "Houston", round: "Group Stage", teams: ["Winner Play-off 1", "Uzbekistan"], price: 95 },
            { id: 19, city: "Miami", round: "Group Stage", teams: ["Argentina", "Algeria"], price: 550 },
            { id: 11, city: "Seattle", round: "Group Stage", teams: ["Netherlands", "Japan"], price: 210 },
            { id: 88, city: "Atlanta", round: "Round of 16", teams: ["TBD", "TBD"], price: 600 },
        ];

        TicketEngine.listings = mockMatches.map(m => ({
            id: `mock-${m.id}`,
            matchNo: m.id,
            matchLabel: `Match ${m.id}: ${m.teams.join(' vs ')}`,
            startingPrice: m.price,
            city: m.city,
            stadium: "Stadium TBD",
            country: "USA", // Simplified for mock
            round: m.round,
            category: "Cat 1",
            faceValue: 0,
            volumeUsd: 0,
            volumeSales: 0,
            lastSale: 0,
            lastSaleDate: "-",
            teams: m.teams,
            fifaCollectUrl: "#"
        }));
    },

    renderLoadingState: () => {
        const tbody = document.getElementById('ticket-table-body');
        if(tbody) tbody.innerHTML = `<tr><td colspan="9" class="p-12 text-center text-emerald-400 animate-pulse font-mono uppercase">Updating prices...</td></tr>`;
    },

    populateFilters: () => {
        const populateSelect = (id, items) => {
            const sel = document.getElementById(id);
            if(!sel) return;
            const current = sel.value;
            sel.innerHTML = `<option value="">All</option>`;
            items.filter(Boolean).sort().forEach(item => {
                const opt = document.createElement('option');
                opt.value = item;
                opt.innerText = item;
                sel.appendChild(opt);
            });
            sel.value = current;
        };

        const cities = [...new Set(TicketEngine.listings.map(l => l.city))];
        const rounds = [...new Set(TicketEngine.listings.map(l => l.round))];
        const cats = [...new Set(TicketEngine.listings.map(l => l.category))];
        const teams = [...new Set(TicketEngine.listings.flatMap(l => l.teams || []))];

        populateSelect('filter-city', cities);
        populateSelect('filter-team', teams);
        populateSelect('filter-round', rounds);
        populateSelect('filter-category', cats);
    },

    // --- UPDATED RENDER FUNCTION FOR MOBILE CARDS ---
    render: () => {
        const tbody = document.getElementById('ticket-table-body');
        const countSpan = document.getElementById('ticket-count');
        if (!tbody) return;

        let result = TicketEngine.listings.filter(row => {
            const f = TicketEngine.state.filter;
            if (f.city && row.city !== f.city) return false;
            if (f.category && row.category !== f.category) return false;
            if (f.round && row.round !== f.round) return false;
            if (f.team && (!row.teams || !row.teams.includes(f.team))) return false;
            if (f.match) {
                const searchStr = f.match.toLowerCase().replace(/\D/g, ''); 
                const rowMatchStr = String(row.matchNo);
                if (searchStr && !rowMatchStr.includes(searchStr)) return false;
            }
            return true;
        });

        const s = TicketEngine.state.sort;
        result.sort((a, b) => {
            if (s === 'priceAsc') return a.startingPrice - b.startingPrice;
            if (s === 'priceDesc') return b.startingPrice - a.startingPrice;
            return a.matchNo - b.matchNo;
        });

        if (countSpan) countSpan.innerText = `${result.length} Listings`;

        if (result.length === 0) {
            tbody.innerHTML = `<tr><td colspan="9" class="p-8 text-center text-gray-500">No tickets found.</td></tr>`;
            return;
        }

        // IMPROVED MOBILE RENDERING
        tbody.innerHTML = result.map(row => `
            <tr class="flex flex-col mb-4 bg-white/5 border border-white/10 rounded-xl p-4 md:table-row md:bg-transparent md:border-b md:border-white/5 md:mb-0 md:rounded-none md:p-0 group">
                
                <!-- Match Number & Mobile Price Header -->
                <td class="flex justify-between items-center w-full md:table-cell md:w-auto md:p-4">
                    <span class="text-emerald-400 font-mono font-bold text-lg md:text-base">#${row.matchNo}</span>
                    <!-- Price shown here ONLY on Mobile -->
                    <span class="md:hidden text-white font-bold text-lg">$${row.startingPrice.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span>
                </td>

                <!-- Match Details -->
                <td class="w-full mt-2 md:mt-0 md:table-cell md:w-auto md:p-4">
                    <div class="font-bold text-white text-base md:text-sm leading-tight">${row.matchLabel}</div>
                    ${row.teams.length > 0 ? `<div class="text-sm md:text-xs text-emerald-400 mt-1">${row.teams.join(' vs ')}</div>` : ''}
                </td>

                <!-- Location (Mobile: Stacked with metadata) -->
                <td class="w-full mt-2 md:mt-0 md:table-cell md:w-auto md:p-4 text-gray-300 text-sm md:text-base">
                    <span class="md:hidden text-gray-500 text-xs uppercase font-bold mr-2">Loc:</span>${row.city}
                </td>

                <!-- Round (Mobile: Stacked) -->
                <td class="w-full mt-1 md:mt-0 md:table-cell md:w-auto md:p-4 text-sm text-gray-400">
                    <span class="md:hidden text-gray-500 text-xs uppercase font-bold mr-2">Round:</span>${row.round}
                </td>

                <!-- Category -->
                <td class="w-full mt-2 md:mt-0 md:table-cell md:w-auto md:p-4">
                    <span class="bg-white/10 px-2 py-1 rounded text-xs uppercase tracking-widest text-gray-300 inline-block">
                        ${row.category}
                    </span>
                </td>

                <!-- Buy Button (Mobile: Full Width Bottom / Desktop: Table Cell) -->
                <td class="w-full mt-4 md:mt-0 md:table-cell md:w-auto md:p-4">
                    <a href="${row.fifaCollectUrl}" target="_blank" class="flex items-center justify-center md:inline-flex gap-2 bg-emerald-600 hover:bg-emerald-500 text-white w-full md:w-auto px-4 py-3 md:py-2 rounded font-bold text-sm uppercase transition shadow-lg md:shadow-none">
                        <!-- Desktop Price Logic -->
                        <span class="hidden md:inline">$${row.startingPrice.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span>
                        <span class="md:hidden">Buy Now</span>
                        <i data-lucide="external-link" class="w-4 h-4 md:w-3 md:h-3"></i>
                    </a>
                </td>
            </tr>
        `).join('');

        if(window.lucide) window.lucide.createIcons();
    }
};

// Start Engine
TicketEngine.init();
</script>

</body>
</html>