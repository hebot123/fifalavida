<!DOCTYPE html>
<html lang="en">
<head>    <meta property="og:image" content="https://fifalavida.com/og-image.jpg">
    <meta property="og:description" content="The unofficial heartbeat of the 2026 World Cup. 104 Matches. 48 Teams. 3 Host Nations.">
    <meta property="og:title" content="FIFA La Vida | World Cup 26™ Hub">
    <meta property="og:url" content="https://fifalavida.com">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="FIFA La Vida | World Cup 26™ Hub">
    <meta name="twitter:description" content="The unofficial heartbeat of the 2026 World Cup. 104 Matches. 48 Teams. 3 Host Nations.">
    <meta name="twitter:image" content="https://fifalavida.com/og-image.jpg">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIFA La Vida | World Cup 26™ Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- GLOBAL CALLBACK FOR GOOGLE MAPS (Moved to Head to prevent Race Condition) -->
    <script>
        function initGoogleMaps() {
            window.isGoogleMapsLoaded = true;
            if (window.app && window.app.state.pendingVenue) {
                window.app.renderMap(window.app.state.pendingVenue);
                window.app.state.pendingVenue = null;
            }
        }
    </script>

    <!-- GOOGLE MAPS API (Replace YOUR_API_KEY with your actual key) -->
    <!-- We include 'libraries=places' to search for hotels/attractions automatically -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBpMLiQsNuXAuCSwR2cyPBQE6VQt56gNck&libraries=places&callback=initGoogleMaps" async defer></script>

    <!-- LOAD LOGIC & DATA -->
    <script src="match-logic.js"></script> 
    <script src="venues.js"></script>
    <script src="chatbot.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        h1, h2, h3, h4, h5, h6, .brand-font { font-family: 'Oswald', sans-serif; text-transform: uppercase; }
        :root { --brand-black: #000000; --brand-white: #FFFFFF; --brand-accent: #34D399; }
        .brand-pattern { background-color: #000000; background-image: radial-gradient(#333 1px, transparent 1px); background-size: 20px 20px; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #111; }
        ::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #fff; }
        @keyframes pulse-live { 0% { box-shadow: 0 0 0 0 rgba(52, 211, 153, 0.4); } 70% { box-shadow: 0 0 0 6px rgba(52, 211, 153, 0); } 100% { box-shadow: 0 0 0 0 rgba(52, 211, 153, 0); } }
        .live-indicator { animation: pulse-live 2s infinite; }
        .article-card:hover img { transform: scale(1.05); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .countdown-box { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(5px); border: 1px solid rgba(255, 255, 255, 0.2); }
        .venue-pin { transition: all 0.3s; cursor: pointer; }
        .venue-pin:hover { transform: scale(1.5); fill: #34D399; }
        
        /* Map Container override */
        #venue-map-container { height: 600px; width: 100%; }
        .gm-style .gm-style-iw { color: #000; } 
    </style>
</head>
<body class="bg-black text-white flex flex-col min-h-screen selection:bg-emerald-500 selection:text-black">

    <!-- Navigation -->
    <nav class="bg-black/90 border-b border-white/10 sticky top-0 z-50 backdrop-blur-md">
        <div class="max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20 items-center">
                <div class="flex-shrink-0 flex items-center gap-3 cursor-pointer group" onclick="app.router('home')">
                    <div class="bg-white text-black p-1 rounded-sm relative overflow-hidden">
                        <div class="absolute inset-0 bg-emerald-500 mix-blend-multiply opacity-0 group-hover:opacity-100 transition"></div>
                        <i data-lucide="trophy" class="h-6 w-6 relative z-10"></i>
                    </div>
                    <div class="flex flex-col leading-none">
                        <span class="brand-font text-2xl font-bold tracking-tighter group-hover:text-emerald-400 transition">FIFA LA VIDA</span>
                        <span class="text-[10px] uppercase tracking-[0.2em] text-gray-500 group-hover:text-gray-300">World Cup Hub</span>
                    </div>
                </div>
                <div class="hidden md:flex space-x-1 items-center">
                    <button onclick="app.router('home')" class="nav-btn text-white bg-white/10 px-4 py-2 rounded text-sm font-bold uppercase tracking-wide transition hover:bg-white hover:text-black" data-target="home">Home</button>
                    <button onclick="app.scrollToPath()" class="nav-btn text-emerald-400 border border-emerald-500/50 bg-emerald-900/10 hover:bg-emerald-500 hover:text-black px-4 py-2 rounded text-sm font-bold uppercase tracking-wide transition flex items-center gap-2 mx-2"><i data-lucide="map" class="w-4 h-4"></i> Path to Glory</button>
                    <button onclick="app.router('tournament')" class="nav-btn text-gray-300 px-4 py-2 rounded text-sm font-bold uppercase tracking-wide transition hover:bg-white hover:text-black flex items-center gap-2" data-target="tournament"><i data-lucide="layout-grid" class="w-4 h-4"></i> Matches</button>
                    <button onclick="app.router('venues')" class="nav-btn text-gray-300 px-4 py-2 rounded text-sm font-bold uppercase tracking-wide transition hover:bg-white hover:text-black flex items-center gap-2"><i data-lucide="map-pin" class="w-4 h-4"></i> Venues</button>
                    <button onclick="app.router('news')" class="nav-btn text-gray-300 px-4 py-2 rounded text-sm font-bold uppercase tracking-wide transition hover:bg-white hover:text-black" data-target="news">Articles</button>
                    <div class="h-6 w-px bg-white/20 mx-4"></div>
                    <a href="https://collect.fifa.com/?referrer=fifalavida" target="_blank" class="bg-white text-black hover:bg-emerald-400 px-6 py-2 rounded font-bold text-sm uppercase transition flex items-center gap-2"><i data-lucide="gem" class="w-4 h-4"></i> Collect</a>
                </div>
                <button id="mobile-menu-btn" class="md:hidden text-white"><i data-lucide="menu" class="h-8 w-8"></i></button>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-black border-b border-white/10 absolute w-full left-0 top-20">
            <div class="px-4 pt-2 pb-4 space-y-2">
                <button onclick="app.router('home')" class="block w-full text-left text-white py-3 font-bold uppercase border-b border-white/10">Home</button>
                <button onclick="app.scrollToPath()" class="block w-full text-left text-emerald-400 py-3 font-bold uppercase border-b border-white/10">Path to Glory</button>
                <button onclick="app.router('tournament')" class="block w-full text-left text-white py-3 font-bold uppercase border-b border-white/10">Matches & Bracket</button>
                <button onclick="app.router('venues')" class="block w-full text-left text-white py-3 font-bold uppercase border-b border-white/10">Host Cities</button>
                <button onclick="app.router('news')" class="block w-full text-left text-white py-3 font-bold uppercase border-b border-white/10">Articles</button>
                <a href="https://collect.fifa.com/?referrer=fifalavida" target="_blank" class="block text-center bg-white text-black py-3 mt-4 font-bold uppercase rounded">FIFA Collect</a>
            </div>
        </div>
    </nav>

    <main id="main-content" class="flex-grow">
        <!-- HOME VIEW -->
        <div id="home-view" class="view-section">
            <div class="relative min-h-[85vh] flex items-center justify-center overflow-hidden brand-pattern group">
                <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1518091043644-c1d4457512c6?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80')] bg-cover bg-center opacity-40 group-hover:scale-105 transition duration-[20s]"></div>
                <div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent"></div>
                <div class="absolute inset-0 bg-gradient-to-r from-black/80 via-transparent to-black/80"></div>
                <div class="relative z-10 text-center px-4 max-w-5xl mx-auto mt-10">
                    <div class="inline-flex items-center gap-3 border border-emerald-500/30 bg-emerald-900/20 backdrop-blur px-4 py-1.5 rounded-full mb-8 animate-fade-up">
                        <div class="w-2 h-2 bg-emerald-500 rounded-full live-indicator"></div>
                        <span class="text-xs font-bold uppercase tracking-widest text-emerald-400">Road to 2026</span>
                    </div>
                    <h1 class="text-7xl md:text-[10rem] font-bold mb-2 leading-[0.85] tracking-tighter drop-shadow-2xl">FIFA <span class="text-transparent bg-clip-text bg-gradient-to-br from-white to-gray-600">LA VIDA</span></h1>
                    <p class="text-xl md:text-2xl text-gray-300 max-w-2xl mx-auto font-light mb-8 mt-6">The unofficial heartbeat of the 2026 World Cup. <br><span class="text-emerald-400 font-bold">104 Matches. 48 Teams. 3 Host Nations.</span></p>
                    <div class="flex flex-wrap justify-center gap-4 mb-12" id="countdown-container">
                        <div class="countdown-box p-4 rounded-lg w-24 md:w-32"><div class="text-3xl md:text-5xl font-bold font-mono" id="cd-days">00</div><div class="text-xs uppercase tracking-widest text-gray-400">Days</div></div>
                        <div class="countdown-box p-4 rounded-lg w-24 md:w-32"><div class="text-3xl md:text-5xl font-bold font-mono" id="cd-hours">00</div><div class="text-xs uppercase tracking-widest text-gray-400">Hours</div></div>
                        <div class="countdown-box p-4 rounded-lg w-24 md:w-32"><div class="text-3xl md:text-5xl font-bold font-mono" id="cd-minutes">00</div><div class="text-xs uppercase tracking-widest text-gray-400">Mins</div></div>
                        <div class="countdown-box p-4 rounded-lg w-24 md:w-32 border-emerald-500/30"><div class="text-3xl md:text-5xl font-bold font-mono text-emerald-400" id="cd-seconds">00</div><div class="text-xs uppercase tracking-widest text-emerald-500/80">Secs</div></div>
                    </div>
                    <div class="flex flex-col md:flex-row gap-4 justify-center">
                        <button onclick="app.router('tournament')" class="bg-white text-black hover:bg-emerald-400 transition-colors font-bold text-lg px-10 py-4 rounded uppercase tracking-widest shadow-[0_0_30px_rgba(255,255,255,0.1)]">Match Schedule</button>
                        <button onclick="app.router('news')" class="bg-transparent border border-white/30 text-white hover:bg-white/10 transition-colors font-bold text-lg px-10 py-4 rounded uppercase tracking-widest">Latest Articles</button>
                    </div>
                </div>
            </div>

            <!-- FAN POLL -->
            <div class="bg-black border-y border-white/10 py-12">
                <div class="max-w-4xl mx-auto px-4">
                    <div class="bg-white/5 border border-white/10 rounded-2xl p-8 flex flex-col md:flex-row items-center gap-8 relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-32 bg-emerald-500/10 rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"></div>
                        <div class="flex-1">
                            <span class="text-emerald-400 font-bold tracking-widest text-xs uppercase mb-2 block">Fan Poll</span>
                            <h3 class="text-3xl font-bold mb-2 uppercase">Who lifts the trophy?</h3>
                            <p class="text-gray-400 text-sm mb-6">Cast your vote for the 2026 champion. Top 4 teams shown.</p>
                            <div class="flex gap-2 max-w-xs">
                                <select id="poll-select" class="bg-black border border-white/20 text-white rounded px-4 py-2 w-full text-sm focus:border-emerald-500 outline-none">
                                    <option value="" disabled selected>Vote for a team...</option>
                                </select>
                                <button onclick="app.handleDropdownVote()" class="bg-emerald-500 hover:bg-emerald-400 text-black font-bold uppercase text-xs px-4 py-2 rounded transition">Vote</button>
                            </div>
                            <button id="undo-vote-btn" onclick="app.clearVote()" class="hidden mt-4 text-xs text-red-400 hover:text-red-300 underline">Undo my vote</button>
                        </div>
                        <div class="flex-1 w-full space-y-3" id="poll-options"></div>
                    </div>
                </div>
            </div>

            <!-- PATH TO GLORY -->
            <div id="path-section" class="bg-[#050505] border-t border-white/10 py-20 scroll-mt-20">
                <div class="max-w-[1400px] mx-auto px-4">
                    <div class="flex flex-col lg:flex-row gap-16">
                        <div class="lg:w-1/3">
                            <div class="sticky top-32">
                                <span class="text-emerald-400 font-bold tracking-widest text-xs uppercase mb-2 block">Tournament Format</span>
                                <h2 class="text-5xl font-bold font-oswald mb-6 uppercase leading-none">Path to <span class="text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-cyan-500">Glory</span></h2>
                                <p class="text-gray-400 mb-8 leading-relaxed">The 2026 World Cup is a test of endurance. 48 teams. 3 countries. Use our interactive tool to visualize the hurdles.</p>
                                <div class="mb-8">
                                    <label class="block text-xs uppercase font-bold text-gray-500 mb-2">Select Your Team</label>
                                    <select id="path-team-select" onchange="app.renderPath()" class="w-full bg-white text-black rounded-lg px-4 py-3 focus:border-emerald-500 outline-none text-lg font-bold shadow-xl border-2 border-gray-200">
                                        <option value="Mexico">Mexico (Host - Group A)</option>
                                        <option value="Canada">Canada (Host - Group B)</option>
                                        <option value="USA">USA (Host - Group D)</option>
                                        <optgroup label="Contenders" id="path-team-options"></optgroup>
                                    </select>
                                </div>
                                <div id="path-ticket-link" class="hidden">
                                    <a href="#" target="_blank" rel="nofollow" class="w-full flex items-center justify-center gap-2 bg-emerald-500 hover:bg-emerald-400 text-black font-bold py-3 rounded transition uppercase tracking-widest shadow-[0_0_20px_rgba(52,211,153,0.4)]">
                                        <i data-lucide="ticket"></i> Find Tickets
                                    </a>
                                    <p class="text-xs text-center text-gray-500 mt-2">* Links to official/partner resale sites</p>
                                </div>
                            </div>
                        </div>
                        <div class="lg:w-2/3">
                            <div id="path-visualizer" class="bg-[#0a0a0a] border border-white/10 rounded-3xl p-8 relative overflow-hidden min-h-[600px]">
                                <div class="absolute inset-0 opacity-20 pointer-events-none">
                                    <svg width="100%" height="100%"><pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse"><path d="M 40 0 L 0 0 0 40" fill="none" stroke="white" stroke-width="0.5"/></pattern><rect width="100%" height="100%" fill="url(#grid)" /></svg>
                                </div>
                                <div id="path-timeline" class="relative z-10 space-y-8"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PREVIEW -->
            <div class="max-w-[1400px] mx-auto px-4 py-20 border-t border-white/10">
                <div class="flex justify-between items-end mb-10">
                    <div><h2 class="text-4xl font-bold mb-2">LATEST <span class="text-emerald-400">ARTICLES</span></h2><p class="text-gray-500">Breakdowns, predictions, and player profiles.</p></div>
                    <button onclick="app.router('news')" class="hidden md:flex items-center gap-2 text-sm font-bold uppercase hover:text-emerald-400 transition">View All <i data-lucide="arrow-right" class="w-4 h-4"></i></button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8" id="home-news-grid"></div>
            </div>
        </div>

        <!-- MATCHES VIEW -->
        <div id="tournament-view" class="view-section hidden bg-[#050505] min-h-screen">
            <div id="matches-component-container"></div>
        </div>

        <!-- VENUES VIEW -->
        <div id="venues-view" class="view-section hidden bg-black min-h-screen pb-20">
            <div class="bg-black/95 backdrop-blur border-b border-white/10 sticky top-20 z-40 py-4">
                <div class="max-w-[1600px] mx-auto px-4"><h2 class="text-2xl font-oswald text-white">HOST CITIES <span class="text-emerald-400">MAP</span></h2></div>
            </div>
            <div class="max-w-[1600px] mx-auto px-4 py-8 flex flex-col lg:flex-row gap-8">
                
                <!-- Interactive Map Column -->
                <div class="w-full lg:w-2/3 relative">
                    <!-- Added ID venue-map-container -->
                    <div id="venue-map-container" class="relative w-full h-[600px] bg-[#111] border border-white/10 rounded-2xl overflow-hidden group">
                        <!-- Static fallback if JS fails -->
                        <div class="absolute inset-0 flex items-center justify-center pointer-events-none text-gray-500 text-sm">Loading Google Maps...</div>
                    </div>
                </div>

                <!-- Info Panel -->
                <div class="w-full lg:w-1/3">
                    <div class="bg-white/5 border border-white/10 rounded-xl p-6 h-full">
                        <h3 class="text-emerald-400 font-bold text-sm uppercase tracking-widest mb-4">Selected Venue</h3>
                        <div id="venue-details">
                            <p class="text-gray-500 text-sm italic">Click a city on the list to view details.</p>
                        </div>
                        <div class="mt-8 border-t border-white/10 pt-4">
                            <div class="grid grid-cols-2 gap-2" id="venue-list-mini">
                                <!-- Mini List -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ARTICLES VIEW -->
        <div id="news-view" class="view-section hidden pt-10 pb-20">
            <div class="max-w-[1400px] mx-auto px-4">
                <h1 class="text-6xl md:text-8xl font-bold mb-10 text-transparent bg-clip-text bg-gradient-to-b from-white to-gray-800">ARTICLES</h1>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-12" id="full-news-grid"></div>
            </div>
        </div>

        <!-- ARTICLE READING -->
        <div id="article-view" class="view-section hidden bg-black min-h-screen pb-20">
            <div id="article-content" class="max-w-3xl mx-auto px-4 pt-10"></div>
        </div>
    </main>

    <footer class="bg-black border-t border-white/10 py-12 mt-auto">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <div class="flex justify-center items-center gap-2 mb-4"><i data-lucide="trophy" class="h-5 w-5 text-emerald-400"></i><div class="brand-font text-2xl font-bold">FIFA LA VIDA</div></div>
            <p class="text-gray-500 text-sm mb-8 max-w-md mx-auto">The ultimate unofficial companion for the 2026 World Cup. Built by fans, for fans.</p>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-8 max-w-2xl mx-auto text-xs text-gray-500 uppercase tracking-widest mb-12">
                <a href="#" class="hover:text-emerald-400 transition" onclick="app.router('home')">Home</a>
                <a href="#" class="hover:text-emerald-400 transition" onclick="app.router('news')">Articles</a>
                <a href="#" class="hover:text-emerald-400 transition" onclick="app.router('tournament')">Bracket</a>
                <a href="mailto:admin@fifalavida.com" class="hover:text-emerald-400 transition">Contact</a>
            </div>
            <p class="text-gray-700 text-[10px]">Not affiliated with FIFA.</p>
        </div>
    </footer>

    <script>
        // --- DATA ---
        // venueData is now loaded from venues.js

        const newsData = [
            { id: 1, title: "Bracketology: The 'Path of Death' in Group C", category: "Analysis", image: "https://images.unsplash.com/photo-1574629810360-7efbbe195018", date: "Nov 22, 2025", snippet: "Why finishing second in Group C might be a tactical masterstroke.", filename: "GroupCanalysis.html" },
            { id: 2, title: "Player Watch: The Next Generation #10s", category: "Scouting", image: "https://images.unsplash.com/photo-1517466787929-bc90951d0974", date: "Oct 24, 2025", snippet: "The classic playmaker is evolving.", filename: "article-player.html" },
            { id: 3, title: "FIFA Collect: The Ultimate Guide (2025)", category: "Fifa Collect", image: "https://images.unsplash.com/photo-1614680376593-902f74cf0d41", date: "Nov 22, 2025", snippet: "Your complete guide to NFT tickets.", filename: "article-fifacollect.html" }
        ];

        window.countryCodes = { "Mexico": "mx", "Canada": "ca", "USA": "us", "Argentina": "ar", "Brazil": "br", "France": "fr", "Germany": "de", "Spain": "es", "England": "gb-eng", "Portugal": "pt", "Netherlands": "nl", "Italy": "it", "Belgium": "be", "Croatia": "hr", "Uruguay": "uy", "Colombia": "co", "Japan": "jp", "South Korea": "kr", "Australia": "au", "Morocco": "ma", "Senegal": "sn", "Cameroon": "cm", "Ghana": "gh", "Saudi Arabia": "sa", "Iran": "ir", "Qatar": "qa", "Switzerland": "ch", "Denmark": "dk", "Sweden": "se", "Poland": "pl", "Ecuador": "ec", "Paraguay": "py", "Chile": "cl", "Peru": "pe", "Venezuela": "ve", "Costa Rica": "cr", "Panama": "pa", "Jamaica": "jm", "Nigeria": "ng", "Algeria": "dz", "Egypt": "eg", "Tunisia": "tn", "Ivory Coast": "ci" };
        window.getFlagHTML = (teamName) => { const clean = teamName.replace(/<[^>]*>?/gm, '').trim(); if (window.countryCodes[clean]) return `<img src="https://flagcdn.com/24x18/${window.countryCodes[clean]}.png" class="w-5 h-3.5 object-cover rounded-sm shadow-sm inline-block mr-2">`; return `<i data-lucide="globe" class="w-4 h-4 text-gray-600 inline-block mr-2 align-middle"></i>`; };

        // --- APP ---
        const app = {
            state: { view: 'home', mapInstance: null, pendingVenue: null, isGmapsLoaded: false },
            newsData: [],

            init: () => {
                lucide.createIcons();
                app.fetchNews();
                
                // Poll
                const select = document.getElementById('poll-select');
                const teamOptGroup = document.getElementById('path-team-options');
                const allTeams = Object.keys(window.countryCodes).sort();
                allTeams.forEach(team => {
                    const opt = document.createElement('option'); opt.value = team; opt.innerText = team; select.appendChild(opt);
                    if(!['Mexico', 'Canada', 'USA'].includes(team)) { const pOpt = document.createElement('option'); pOpt.value = team; pOpt.innerText = team; teamOptGroup.appendChild(pOpt); }
                });
                const savedVote = localStorage.getItem('fifa_poll_vote');
                if(savedVote) { app.recordVoteInternal(savedVote); document.getElementById('undo-vote-btn').classList.remove('hidden'); }
                app.renderPoll();
                
                app.renderPath(); 
                app.renderVenues();
                app.startCountdown();
                
                document.getElementById('mobile-menu-btn').addEventListener('click', () => document.getElementById('mobile-menu').classList.toggle('hidden'));
                
                // If deep-linked to venues, select default
                if (window.location.hash === '#venues') app.router('venues');
            },

            // Render News
            renderNews: () => {
                const createCard = (a) => `<div onclick="app.router('article', ${a.id})" class="cursor-pointer bg-white/5 border border-white/10 rounded-xl overflow-hidden hover:border-emerald-500 transition"><div class="h-48 bg-gray-800"><img src="${a.image}" class="w-full h-full object-cover"></div><div class="p-6"><h3 class="font-bold text-xl mb-2 font-oswald">${a.title}</h3><p class="text-sm text-gray-400">${a.snippet}</p></div></div>`;
                document.getElementById('home-news-grid').innerHTML = app.newsData.slice(0,3).map(createCard).join('');
                document.getElementById('full-news-grid').innerHTML = app.newsData.map(createCard).join('');
            },

            // Path To Glory Logic
            renderPath: () => {
                const team = document.getElementById('path-team-select').value;
                const container = document.getElementById('path-timeline');
                const ticketContainer = document.getElementById('path-ticket-link');
                
                let steps = [];
                if (team === 'Mexico') {
                    steps = [
                        { stage: "Match 1 (Opening Match)", dates: "June 11", loc: "Mexico City", desc: "Kicking off the tournament at the historic Estadio Azteca." },
                        { stage: "Match 26", dates: "June 18", loc: "Guadalajara", desc: "Second group stage test at Estadio Akron." },
                        { stage: "Match 53", dates: "June 24", loc: "Mexico City", desc: "Final group match back at the Azteca to secure a knockout spot." },
                        { stage: "Round of 32", dates: "June 30", loc: "Mexico City (If 1st in Group A)", desc: "A potential knockout game on home soil." },
                        { stage: "Round of 16", dates: "July 5", loc: "Mexico City (If path allows)", desc: "The dream of a deep run continues." }
                    ];
                } else if (team === 'Canada') {
                    steps = [
                        { stage: "Match 3", dates: "June 12", loc: "Toronto", desc: "Canada's campaign begins at BMO Field." },
                        { stage: "Match 28", dates: "June 18", loc: "Vancouver", desc: "Cross-country trip to face their second opponent at BC Place." },
                        { stage: "Match 52", dates: "June 24", loc: "Vancouver", desc: "Final group match, aiming to advance from Group B." },
                        { stage: "Round of 32", dates: "July 2", loc: "Vancouver (If 1st in Group B)", desc: "A chance to play a knockout match at home." }
                    ];
                } else if (team === 'USA') {
                    steps = [
                        { stage: "Match 4", dates: "June 12", loc: "Los Angeles", desc: "The USMNT starts their journey at SoFi Stadium." },
                        { stage: "Match 32", dates: "June 19", loc: "Seattle", desc: "Heading to the pacific northwest and Lumen Field." },
                        { stage: "Match 55", dates: "June 25", loc: "Los Angeles", desc: "Returning to LA to close out the group stage." },
                        { stage: "Round of 32", dates: "July 1", loc: "Los Angeles (If 1st in Group D)", desc: "Fighting for a spot in the Round of 16 at home." }
                    ];
                } else {
                    steps = [
                        { stage: "Group Stage", dates: "TBD", loc: "Various Cities", desc: "Fight for a top-2 finish to qualify for the knockouts." },
                        { stage: "Knockouts", dates: "June 28+", loc: "USA/Mexico/Canada", desc: "Survival of the fittest in the single-elimination bracket." }
                    ];
                }

                container.innerHTML = steps.map((s, i) => `<div class="flex gap-6 group"><div class="flex flex-col items-center"><div class="w-4 h-4 rounded-full bg-emerald-500 border-4 border-emerald-900 shadow-[0_0_15px_rgba(52,211,153,0.5)] z-10 relative"></div>${i!==steps.length-1?'<div class="w-0.5 h-20 bg-white/10 group-hover:bg-emerald-500/50 transition duration-500"></div>':''}</div><div class="pb-8"><span class="text-xs font-bold text-emerald-400 uppercase tracking-widest">${s.dates}</span><h3 class="text-2xl font-bold text-white mb-1">${s.stage}</h3><div class="flex items-center gap-2 text-sm text-gray-400 mb-2"><i data-lucide="map-pin" class="w-3 h-3"></i> ${s.loc}</div><p class="text-gray-500 text-sm leading-relaxed max-w-md">${s.desc}</p></div></div>`).join('') + `<div class="flex gap-6 mt-2 opacity-50 group hover:opacity-100 transition"><div class="flex flex-col items-center"><div class="w-4 h-4 rounded-full bg-yellow-500 border-4 border-yellow-900 shadow-[0_0_15px_rgba(234,179,8,0.5)]"></div></div><div><span class="text-xs font-bold text-yellow-500 uppercase tracking-widest">July 19, 2026</span><h3 class="text-2xl font-bold text-white">World Cup Final</h3><div class="text-sm text-gray-400">New York / New Jersey</div></div></div>`;
                
                // UPDATED LINK: Viagogo Affiliate Link
                const ticketUrl = "https://viagogo.prf.hn/click/camref:1110ltZ7y/[p_id:1110l23734]/destination:https%3A%2F%2Fwww.viagogo.com%2FSports-Tickets%2FSoccer%2FSoccer-Tournament%2FSoccer-World-Cup-Tickets%3Fagqi%3D5ff4c7ee-562d-42dc-8b3d-90428039fcb0%26agi%3Dstubhub%26agut%3Dd0fd2010-cb9f-4d0f-b13c-553113c1bfed";
                
                if(ticketContainer) { 
                    ticketContainer.querySelector('a').href = ticketUrl; 
                    ticketContainer.classList.remove('hidden'); 
                }
                lucide.createIcons();
            },

            // Interactive Map Logic
            selectVenue: (city) => {
                const venue = venueData.find(v => v.city === city);
                if(!venue) return;
                
                const details = document.getElementById('venue-details');
                
                // Helper to generate list items
                const renderList = (items) => (items || []).map(i => `<li class="text-gray-400 text-sm mb-1 pl-3 relative"><span class="absolute left-0 top-1.5 w-1 h-1 bg-emerald-500 rounded-full"></span> ${i}</li>`).join('');

                // Update Side Panel
                details.innerHTML = `
                    <div class="mb-6">
                        <h2 class="text-4xl font-bold font-oswald text-white mb-1">${venue.city}</h2>
                        <div class="text-xl text-emerald-400">${venue.stadium}</div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="bg-white/10 p-3 rounded">
                            <span class="block text-xs text-gray-400 uppercase">Capacity</span>
                            <span class="font-bold text-white">${venue.cap}</span>
                        </div>
                        <div class="bg-white/10 p-3 rounded">
                            <span class="block text-xs text-gray-400 uppercase">Matches</span>
                            <span class="font-bold text-white">${venue.matches}</span>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h4 class="text-emerald-400 font-bold text-xs uppercase tracking-widest mb-3 border-b border-white/10 pb-2">Top Attractions</h4>
                        <ul class="space-y-1">${renderList(venue.attractions)}</ul>
                    </div>
                    <div class="mb-6">
                        <h4 class="text-emerald-400 font-bold text-xs uppercase tracking-widest mb-3 border-b border-white/10 pb-2">Where to Stay</h4>
                        <ul class="space-y-1">${renderList(venue.hotels)}</ul>
                    </div>

                    <button onclick="app.viewMatchesForVenue('${venue.city.replace("'","\\'") }')" class="w-full bg-emerald-600 hover:bg-emerald-500 text-white font-bold py-3 rounded transition uppercase tracking-widest mt-4">View Matches</button>
                `;
                
                // --- RENDER MAP ---
                app.renderMap(venue);
            },

            renderMap: (venue) => {
                const containerId = 'venue-map-container';
                const container = document.getElementById(containerId);
                
                if(!window.isGoogleMapsLoaded) {
                    app.state.pendingVenue = venue;
                    if(window.google && window.google.maps) initGoogleMaps(); // Retry if script loaded but callback missed
                    return;
                }
                
                // Convert [lat, lng] to {lat, lng}
                const position = { lat: venue.coords[0], lng: venue.coords[1] };
                
                // Init Map with Dark Style
                const map = new google.maps.Map(container, {
                    center: position,
                    zoom: 13,
                    mapId: 'DEMO_MAP_ID', // Optional: for vector maps if user has it
                    styles: [
                        { elementType: "geometry", stylers: [{ color: "#242f3e" }] },
                        { elementType: "labels.text.stroke", stylers: [{ color: "#242f3e" }] },
                        { elementType: "labels.text.fill", stylers: [{ color: "#746855" }] },
                        { featureType: "administrative.locality", elementType: "labels.text.fill", stylers: [{ color: "#d59563" }] },
                        { featureType: "poi", elementType: "labels.text.fill", stylers: [{ color: "#d59563" }] },
                        { featureType: "poi.park", elementType: "geometry", stylers: [{ color: "#263c3f" }] },
                        { featureType: "road", elementType: "geometry", stylers: [{ color: "#38414e" }] },
                        { featureType: "road", elementType: "geometry.stroke", stylers: [{ color: "#212a37" }] },
                        { featureType: "road.highway", elementType: "geometry", stylers: [{ color: "#746855" }] },
                        { featureType: "water", elementType: "geometry", stylers: [{ color: "#17263c" }] }
                    ]
                });

                // Stadium Marker
                new google.maps.Marker({
                    position: position,
                    map: map,
                    title: venue.stadium,
                    icon: {
                        path: google.maps.SymbolPath.CIRCLE,
                        scale: 10,
                        fillColor: "#34D399",
                        fillOpacity: 1,
                        strokeWeight: 2,
                        strokeColor: "#ffffff"
                    }
                });

                // Nearby Search for Hotels & Attractions
                const service = new google.maps.places.PlacesService(map);
                
                // Search for attractions
                service.nearbySearch({
                    location: position,
                    radius: 3000,
                    type: ['tourist_attraction']
                }, (results, status) => {
                    if (status === google.maps.places.PlacesServiceStatus.OK) {
                        results.forEach(place => {
                            new google.maps.Marker({
                                position: place.geometry.location,
                                map: map,
                                title: place.name,
                                icon: {
                                    url: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png"
                                }
                            });
                        });
                    }
                });

                // Search for hotels
                service.nearbySearch({
                    location: position,
                    radius: 3000,
                    type: ['lodging']
                }, (results, status) => {
                    if (status === google.maps.places.PlacesServiceStatus.OK) {
                        results.forEach(place => {
                            new google.maps.Marker({
                                position: place.geometry.location,
                                map: map,
                                title: place.name,
                                icon: {
                                    url: "http://maps.google.com/mapfiles/ms/icons/purple-dot.png"
                                }
                            });
                        });
                    }
                });

                app.state.mapInstance = map;
            },

            renderVenues: () => {
                const list = document.getElementById('venue-list-mini');
                if(!list) return; 
                
                list.innerHTML = venueData.map(v => `
                    <div onclick="app.selectVenue('${v.city}')" class="p-2 bg-black/40 hover:bg-emerald-900/40 rounded cursor-pointer border border-white/5 hover:border-emerald-500/30 transition flex items-center justify-between">
                        <span class="text-xs font-bold text-gray-300">${v.city}</span>
                        <i data-lucide="chevron-right" class="w-3 h-3 text-gray-600"></i>
                    </div>
                `).join('');
                
                // Select first venue by default if none selected
                if (!app.state.mapInstance && venueData.length > 0) {
                     app.selectVenue('Mexico City'); // Default to Mexico City
                }
            },

            // Router
            scrollToPath: () => { app.router('home'); setTimeout(() => document.getElementById('path-section').scrollIntoView({behavior:'smooth'}), 100); },
            scrollToVenues: () => { app.router('venues'); window.scrollTo({top:0, behavior:'smooth'}); },
            
            // Show matches for a specific venue: navigates to matches view and applies a venue filter
            viewMatchesForVenue: async (city) => {
                if(!city) return;
                // Navigate to tournament view which loads matches.html and initializes MatchEngine
                await app.router('tournament');
                try {
                    if(typeof MatchEngine !== 'undefined' && typeof MatchEngine.setVenue === 'function') {
                        MatchEngine.setVenue(city);
                    }
                } catch(e) { console.warn('Unable to filter matches by venue', e); }
            },
            
            router: async (view, param) => {
                if(view !== 'home' && view !== 'venues') window.scrollTo({top:0,behavior:'smooth'});
                app.state.view = view;
                document.querySelectorAll('.view-section').forEach(e => e.classList.add('hidden'));
                document.getElementById('mobile-menu').classList.add('hidden');
                
                if(view==='article' && param) {
                    await app.renderArticle(param);
                    document.getElementById('article-view').classList.remove('hidden');
                } else if (view === 'tournament') {
                    document.getElementById('tournament-view').classList.remove('hidden');
                    const container = document.getElementById('matches-component-container');
                    if(container.innerHTML === '') {
                        try {
                            const r = await fetch('matches.html');
                            if(r.ok) { container.innerHTML = await r.text(); if(typeof MatchEngine !== 'undefined') MatchEngine.init(); }
                        } catch (e) { container.innerHTML = `<div class="text-white p-10 text-center">Matches logic loaded via MatchEngine.</div>`; if(typeof MatchEngine !== 'undefined') MatchEngine.init(); }
                    }
                } else {
                    document.getElementById(`${view}-view`).classList.remove('hidden');
                }
                lucide.createIcons();
            },

            // Poll Logic (Condensed)
            pollOptions: [{ name: "Brazil", votes: 240, color: "bg-yellow-500" }, { name: "France", votes: 210, color: "bg-blue-600" }, { name: "Argentina", votes: 180, color: "bg-sky-400" }, { name: "England", votes: 95, color: "bg-white" }],
            recordVoteInternal: (t) => { const e = app.pollOptions.find(p => p.name === t); if(!e) app.pollOptions.push({ name: t, votes: 1, color: 'bg-emerald-500' }); app.pollOptions.sort((a, b) => b.votes - a.votes); },
            handleDropdownVote: () => { const v = document.getElementById('poll-select').value; if(v) app.vote(v); },
            vote: (t) => { if(localStorage.getItem('fifa_poll_vote') === t) { app.clearVote(); return; } const o = app.pollOptions.find(p => p.name === t); if(o) o.votes++; else app.pollOptions.push({ name: t, votes: 1, color: 'bg-emerald-500' }); localStorage.setItem('fifa_poll_vote', t); document.getElementById('undo-vote-btn').classList.remove('hidden'); app.pollOptions.sort((a, b) => b.votes - a.votes); app.renderPoll(); },
            clearVote: () => { const c = localStorage.getItem('fifa_poll_vote'); if(c) { const o = app.pollOptions.find(p => p.name === c); if(o) o.votes--; localStorage.removeItem('fifa_poll_vote'); } document.getElementById('undo-vote-btn').classList.add('hidden'); document.getElementById('poll-select').value = ""; app.pollOptions.sort((a, b) => b.votes - a.votes); app.renderPoll(); },
            renderPoll: () => { const c = document.getElementById('poll-options'); if(!c) return; const t = app.pollOptions.reduce((a, v) => a + v.votes, 0); const u = localStorage.getItem('fifa_poll_vote'); c.innerHTML = app.pollOptions.slice(0,4).map(o => `<div class="relative h-12 bg-white/5 rounded border ${u===o.name?'border-emerald-500':'border-transparent'} overflow-hidden cursor-pointer group hover:bg-white/10 transition" onclick="app.vote('${o.name}')"><div class="absolute inset-y-0 left-0 ${o.color} opacity-20 transition-all duration-1000" style="width: ${t>0?Math.round((o.votes/t)*100):0}%"></div><div class="absolute inset-0 flex items-center justify-between px-4"><span class="font-bold text-sm uppercase flex items-center gap-2">${o.name} ${u===o.name?'<i data-lucide="check-circle" class="w-3 h-3 text-emerald-400"></i>':''}</span><span class="text-xs font-mono text-gray-400">${t>0?Math.round((o.votes/t)*100):0}%</span></div></div>`).join(''); lucide.createIcons(); },

            fetchNews: async () => { try { const r = await fetch('news.json'); app.newsData = r.ok ? await r.json() : []; } catch (e) { app.newsData = newsData; } app.renderNews(); },
            renderArticle: async (id) => { const a = app.newsData.find(n => n.id === id); if(!a) return; let c = ""; try { const r = await fetch(`articles/${a.filename}`); c = r.ok ? await r.text() : a.content; } catch (e) { c = a.content; } document.getElementById('article-content').innerHTML = `<button onclick="app.router('news')" class="text-gray-400 hover:text-white mb-8 flex items-center gap-2 text-sm uppercase font-bold tracking-widest transition"><i data-lucide="arrow-left" class="w-4 h-4"></i> Back to Articles</button><div class="mb-8"><div class="flex items-center gap-3 mb-4"><span class="bg-emerald-500/20 text-emerald-400 px-3 py-1 rounded text-xs font-bold uppercase tracking-wider border border-emerald-500/30">${a.category}</span></div><h1 class="text-4xl md:text-6xl font-bold font-oswald mb-6 leading-tight">${a.title}</h1></div><div class="w-full h-[400px] mb-10 rounded-xl overflow-hidden bg-gray-800"><img src="${a.image}" class="w-full h-full object-cover"></div><div class="prose prose-invert prose-lg max-w-none text-gray-300">${c}</div>`; lucide.createIcons(); },
            
            startCountdown: () => { const d = new Date('June 11, 2026 12:00:00').getTime(); setInterval(() => { const n = new Date().getTime(), dist = d - n; if(dist<0) { document.getElementById("countdown-container").innerHTML = "LIVE!"; return; } document.getElementById("cd-days").innerText = String(Math.floor(dist/(1000*60*60*24))).padStart(2,'0'); document.getElementById("cd-hours").innerText = String(Math.floor((dist%(1000*60*60*24))/(1000*60*60))).padStart(2,'0'); document.getElementById("cd-minutes").innerText = String(Math.floor((dist%(1000*60*60))/(1000*60))).padStart(2,'0'); document.getElementById("cd-seconds").innerText = String(Math.floor((dist%(1000*60))/1000)).padStart(2,'0'); }, 1000); }
        };

        window.app = app; // Make app object globally accessible for the callback
        window.addEventListener('DOMContentLoaded', app.init);
    </script>

    <!-- Chatbot container -->
    <div id="chatbot-container"></div>
</body>

</html>