<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIFA La Vida | World Cup 26™ Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        /* Brand Fonts */
        body { font-family: 'Inter', sans-serif; }
        h1, h2, h3, h4, h5, h6, .brand-font { font-family: 'Oswald', sans-serif; text-transform: uppercase; }
        
        /* FIFA 26™ Inspired Theme - High Contrast */
        :root {
            --brand-black: #000000;
            --brand-white: #FFFFFF;
            --brand-accent: #34D399; /* Emerald-ish accent for data */
        }

        /* Custom Patterns */
        .brand-pattern {
            background-color: #000000;
            background-image: radial-gradient(#333 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #111; }
        ::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #fff; }

        /* Animations */
        @keyframes pulse-live {
            0% { box-shadow: 0 0 0 0 rgba(52, 211, 153, 0.4); }
            70% { box-shadow: 0 0 0 6px rgba(52, 211, 153, 0); }
            100% { box-shadow: 0 0 0 0 rgba(52, 211, 153, 0); }
        }
        .live-indicator {
            animation: pulse-live 2s infinite;
        }
        
        .article-card:hover img {
            transform: scale(1.05);
        }
        
        /* Utility for hiding scrollbar but keeping functionality */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        /* Countdown Box Style */
        .countdown-box {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="bg-black text-white flex flex-col min-h-screen selection:bg-emerald-500 selection:text-black">

    <!-- Navigation -->
    <nav class="bg-black/90 border-b border-white/10 sticky top-0 z-50 backdrop-blur-md">
        <div class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20 items-center">
                <!-- Logo -->
                <div class="flex-shrink-0 flex items-center gap-3 cursor-pointer group" onclick="app.router('home')">
                    <div class="bg-white text-black p-1 rounded-sm relative overflow-hidden">
                        <div class="absolute inset-0 bg-emerald-500 mix-blend-multiply opacity-0 group-hover:opacity-100 transition"></div>
                        <i data-lucide="trophy" class="h-6 w-6 relative z-10"></i>
                    </div>
                    <div class="flex flex-col leading-none">
                        <span class="brand-font text-2xl font-bold tracking-tighter group-hover:text-emerald-400 transition">FIFA LA VIDA</span>
                        <span class="text-[10px] uppercase tracking-[0.2em] text-gray-500 group-hover:text-gray-300">World Cup Hub</span>
                    </div>
                </div>
                
                <!-- Desktop Menu -->
                <div class="hidden md:flex space-x-1 items-center">
                    <button onclick="app.router('home')" class="nav-btn text-white bg-white/10 px-4 py-2 rounded text-sm font-bold uppercase tracking-wide transition hover:bg-white hover:text-black" data-target="home">Home</button>
                    <button onclick="app.router('news')" class="nav-btn text-gray-300 px-4 py-2 rounded text-sm font-bold uppercase tracking-wide transition hover:bg-white hover:text-black" data-target="news">Analysis</button>
                    <button onclick="app.router('tournament')" class="nav-btn text-gray-300 px-4 py-2 rounded text-sm font-bold uppercase tracking-wide transition hover:bg-white hover:text-black flex items-center gap-2" data-target="tournament">
                        <i data-lucide="layout-grid" class="w-4 h-4"></i> Matches
                    </button>
                    <div class="h-6 w-px bg-white/20 mx-4"></div>
                    <a href="https://collect.fifa.com/?referrer=fifalavida" target="_blank" class="bg-white text-black hover:bg-emerald-400 px-6 py-2 rounded font-bold text-sm uppercase transition flex items-center gap-2">
                        <i data-lucide="gem" class="w-4 h-4"></i> FIFA Collect
                    </a>
                </div>

                <!-- Mobile Toggle -->
                <button id="mobile-menu-btn" class="md:hidden text-white"><i data-lucide="menu" class="h-8 w-8"></i></button>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-black border-b border-white/10 absolute w-full left-0 top-20">
            <div class="px-4 pt-2 pb-4 space-y-2">
                <button onclick="app.router('home')" class="block w-full text-left text-white py-3 font-bold uppercase border-b border-white/10">Home</button>
                <button onclick="app.router('news')" class="block w-full text-left text-white py-3 font-bold uppercase border-b border-white/10">Analysis</button>
                <button onclick="app.router('tournament')" class="block w-full text-left text-white py-3 font-bold uppercase border-b border-white/10">Matches & Bracket</button>
                <a href="https://collect.fifa.com/?referrer=fifalavida" target="_blank" class="block text-center bg-white text-black py-3 mt-4 font-bold uppercase rounded">FIFA Collect</a>
            </div>
        </div>
    </nav>

    <!-- MAIN CONTAINER -->
    <main id="main-content" class="flex-grow">
        
        <!-- HOME VIEW -->
        <div id="home-view" class="view-section">
            <!-- Hero -->
            <div class="relative min-h-[85vh] flex items-center justify-center overflow-hidden brand-pattern group">
                <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1518091043644-c1d4457512c6?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80')] bg-cover bg-center opacity-40 group-hover:scale-105 transition duration-[20s]"></div>
                <div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent"></div>
                <div class="absolute inset-0 bg-gradient-to-r from-black/80 via-transparent to-black/80"></div>
                
                <div class="relative z-10 text-center px-4 max-w-5xl mx-auto mt-10">
                    <div class="inline-flex items-center gap-3 border border-emerald-500/30 bg-emerald-900/20 backdrop-blur px-4 py-1.5 rounded-full mb-8 animate-fade-up">
                        <div class="w-2 h-2 bg-emerald-500 rounded-full live-indicator"></div>
                        <span class="text-xs font-bold uppercase tracking-widest text-emerald-400">Road to 2026</span>
                    </div>
                    <h1 class="text-7xl md:text-[10rem] font-bold mb-2 leading-[0.85] tracking-tighter drop-shadow-2xl">
                        FIFA <span class="text-transparent bg-clip-text bg-gradient-to-br from-white to-gray-600">LA VIDA</span>
                    </h1>
                    <p class="text-xl md:text-2xl text-gray-300 max-w-2xl mx-auto font-light mb-8 mt-6">
                        The unofficial heartbeat of the 2026 World Cup. <br>
                        <span class="text-emerald-400 font-bold">104 Matches. 48 Teams. 3 Host Nations.</span>
                    </p>

                    <!-- COUNTDOWN TIMER -->
                    <div class="flex flex-wrap justify-center gap-4 mb-12" id="countdown-container">
                        <div class="countdown-box p-4 rounded-lg w-24 md:w-32">
                            <div class="text-3xl md:text-5xl font-bold font-mono" id="cd-days">00</div>
                            <div class="text-xs uppercase tracking-widest text-gray-400">Days</div>
                        </div>
                        <div class="countdown-box p-4 rounded-lg w-24 md:w-32">
                            <div class="text-3xl md:text-5xl font-bold font-mono" id="cd-hours">00</div>
                            <div class="text-xs uppercase tracking-widest text-gray-400">Hours</div>
                        </div>
                        <div class="countdown-box p-4 rounded-lg w-24 md:w-32">
                            <div class="text-3xl md:text-5xl font-bold font-mono" id="cd-minutes">00</div>
                            <div class="text-xs uppercase tracking-widest text-gray-400">Mins</div>
                        </div>
                        <div class="countdown-box p-4 rounded-lg w-24 md:w-32 border-emerald-500/30">
                            <div class="text-3xl md:text-5xl font-bold font-mono text-emerald-400" id="cd-seconds">00</div>
                            <div class="text-xs uppercase tracking-widest text-emerald-500/80">Secs</div>
                        </div>
                    </div>

                    <div class="flex flex-col md:flex-row gap-4 justify-center">
                        <button onclick="app.router('tournament')" class="bg-white text-black hover:bg-emerald-400 transition-colors font-bold text-lg px-10 py-4 rounded uppercase tracking-widest shadow-[0_0_30px_rgba(255,255,255,0.1)]">
                            Match Schedule
                        </button>
                        <button onclick="app.router('news')" class="bg-transparent border border-white/30 text-white hover:bg-white/10 transition-colors font-bold text-lg px-10 py-4 rounded uppercase tracking-widest">
                            Latest Analysis
                        </button>
                    </div>
                </div>
            </div>

            <!-- Featured News Preview -->
            <div class="max-w-[1400px] mx-auto px-4 py-20">
                <div class="flex justify-between items-end mb-10">
                    <div>
                        <h2 class="text-4xl font-bold mb-2">MATCH <span class="text-emerald-400">ANALYSIS</span></h2>
                        <p class="text-gray-500">Breakdowns, predictions, and player profiles.</p>
                    </div>
                    <button onclick="app.router('news')" class="hidden md:flex items-center gap-2 text-sm font-bold uppercase hover:text-emerald-400 transition">View All <i data-lucide="arrow-right" class="w-4 h-4"></i></button>
                </div>

                <!-- LOADING STATE -->
                <div id="home-news-loading" class="text-center py-10">
                     <div class="inline-block w-8 h-8 border-4 border-emerald-500 border-t-transparent rounded-full animate-spin"></div>
                     <p class="text-gray-500 mt-4 text-xs uppercase tracking-widest">Fetching Content...</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 hidden" id="home-news-grid">
                    <!-- Injected by JS -->
                </div>
            </div>
        </div>

        <!-- NEWS LIST VIEW -->
        <div id="news-view" class="view-section hidden pt-10 pb-20">
            <div class="max-w-[1400px] mx-auto px-4">
                <h1 class="text-6xl md:text-8xl font-bold mb-10 text-transparent bg-clip-text bg-gradient-to-b from-white to-gray-800">ANALYSIS</h1>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-12" id="full-news-grid">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>

        <!-- ARTICLE READING VIEW -->
        <div id="article-view" class="view-section hidden bg-black min-h-screen pb-20">
            <div id="article-loader" class="text-center py-32 hidden">
                <div class="inline-block w-8 h-8 border-4 border-emerald-500 border-t-transparent rounded-full animate-spin"></div>
                <p class="text-gray-500 mt-4 text-xs uppercase tracking-widest">Loading Article...</p>
            </div>
            
            <div id="article-content" class="max-w-3xl mx-auto px-4 pt-10">
                <!-- Dynamic Article -->
            </div>
        </div>

        <!-- TOURNAMENT VIEW -->
        <div id="tournament-view" class="view-section hidden bg-[#050505] min-h-screen">
             <!-- Sticky Sub-Nav -->
             <div class="bg-black/95 backdrop-blur border-b border-white/10 sticky top-20 z-40 py-4">
                <div class="max-w-[1600px] mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-4">
                    <div class="flex gap-2 p-1 rounded-lg overflow-x-auto w-full md:w-auto no-scrollbar">
                        <button onclick="app.setFilter('all')" id="btn-all" class="filter-btn px-6 py-2 rounded font-bold text-sm uppercase bg-white text-black transition whitespace-nowrap shadow-[0_0_15px_rgba(255,255,255,0.2)]">All Matches</button>
                        <button onclick="app.setFilter('group')" id="btn-group" class="filter-btn px-6 py-2 rounded font-bold text-sm uppercase text-gray-500 hover:text-white transition whitespace-nowrap">Group Stage</button>
                        <button onclick="app.setFilter('knockout')" id="btn-knockout" class="filter-btn px-6 py-2 rounded font-bold text-sm uppercase text-gray-500 hover:text-white transition whitespace-nowrap">Knockout</button>
                        <button onclick="app.setFilter('calendar')" id="btn-calendar" class="filter-btn px-6 py-2 rounded font-bold text-sm uppercase text-gray-500 hover:text-white transition whitespace-nowrap flex items-center gap-2"><i data-lucide="calendar" class="w-3 h-3"></i> Calendar</button>
                    </div>
                </div>
            </div>

            <div class="max-w-[1600px] mx-auto px-4 py-8">
                <div id="matches-container" class="grid gap-6 animate-fade-in">
                    <!-- Content populated by JS -->
                </div>
            </div>
        </div>

    </main>

    <footer class="bg-black border-t border-white/10 py-12 mt-auto">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <div class="flex justify-center items-center gap-2 mb-4">
                 <i data-lucide="trophy" class="h-5 w-5 text-emerald-400"></i>
                 <div class="brand-font text-2xl font-bold">FIFA LA VIDA</div>
            </div>
            <p class="text-gray-500 text-sm mb-8 max-w-md mx-auto">
                The ultimate unofficial companion for the 2026 World Cup. Built by fans, for fans.
            </p>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-8 max-w-2xl mx-auto text-xs text-gray-500 uppercase tracking-widest mb-12">
                <a href="#" class="hover:text-emerald-400 transition" onclick="app.router('home')">Home</a>
                <a href="#" class="hover:text-emerald-400 transition" onclick="app.router('news')">Analysis</a>
                <a href="#" class="hover:text-emerald-400 transition" onclick="app.router('tournament')">Bracket</a>
                <a href="mailto:admin@fifalavida.com" class="hover:text-emerald-400 transition">Contact</a>
            </div>
            <p class="text-gray-700 text-[10px]">Not affiliated with FIFA.</p>
        </div>
    </footer>

    <script>
        // --- HELPERS (Flags) ---
        const countryCodes = { "Mexico": "mx", "Canada": "ca", "USA": "us", "Argentina": "ar", "Brazil": "br", "France": "fr", "Germany": "de", "Spain": "es", "England": "gb-eng", "Portugal": "pt", "Netherlands": "nl", "Italy": "it", "Belgium": "be", "Croatia": "hr", "Uruguay": "uy", "Colombia": "co", "Japan": "jp", "South Korea": "kr", "Australia": "au", "Morocco": "ma", "Senegal": "sn", "Cameroon": "cm", "Ghana": "gh", "Saudi Arabia": "sa", "Iran": "ir", "Qatar": "qa", "Switzerland": "ch", "Denmark": "dk", "Sweden": "se", "Poland": "pl" };
        
        function getFlagHTML(teamName) {
            // Strip HTML tags if any (passed from TBD logic)
            const cleanName = teamName.replace(/<[^>]*>?/gm, '').trim();
            if (countryCodes[cleanName]) return `<img src="https://flagcdn.com/24x18/${countryCodes[cleanName]}.png" class="w-5 h-3.5 object-cover rounded-sm shadow-sm inline-block mr-2">`;
            return `<i data-lucide="globe" class="w-4 h-4 text-gray-600 inline-block mr-2 align-middle"></i>`;
        }

        // --- BRACKET DATA ---
        const officialVenues = {
            1: "Azteca, Mexico City", 2: "Guadalajara", 3: "Toronto", 4: "Los Angeles",
            5: "Boston", 6: "Vancouver", 7: "New York/New Jersey", 8: "San Francisco",
            9: "Philadelphia", 10: "Houston", 11: "Dallas", 12: "Monterrey",
            13: "Miami", 14: "Atlanta", 15: "Los Angeles", 16: "Seattle",
            17: "New York/New Jersey", 18: "Boston", 19: "Kansas City", 20: "San Francisco",
            21: "Toronto", 22: "Dallas", 23: "Houston", 24: "Azteca, Mexico City",
            25: "Atlanta", 26: "Los Angeles", 27: "Vancouver", 28: "Guadalajara",
            29: "Philadelphia", 30: "Boston", 31: "San Francisco", 32: "Seattle",
            33: "Toronto", 34: "Kansas City", 35: "Houston", 36: "Monterrey",
            37: "Miami", 38: "Atlanta", 39: "Los Angeles", 40: "Vancouver",
            41: "New York/New Jersey", 42: "Philadelphia", 43: "Dallas", 44: "San Francisco",
            45: "Boston", 46: "Toronto", 47: "Houston", 48: "Guadalajara",
            49: "Miami", 50: "Atlanta", 51: "Vancouver", 52: "Seattle",
            53: "Azteca, Mexico City", 54: "Monterrey", 55: "Philadelphia", 56: "New York/New Jersey",
            57: "Dallas", 58: "Kansas City", 59: "Los Angeles", 60: "San Francisco",
            61: "Boston", 62: "Toronto", 63: "Seattle", 64: "Vancouver",
            65: "Houston", 66: "Guadalajara", 67: "New York/New Jersey", 68: "Philadelphia",
            69: "Kansas City", 70: "Dallas", 71: "Miami", 72: "Atlanta",
            73: "Los Angeles", 74: "Boston", 75: "Monterrey", 76: "Houston",
            77: "New York/New Jersey", 78: "Dallas", 79: "Azteca, Mexico City", 80: "Atlanta",
            81: "San Francisco", 82: "Seattle", 83: "Toronto", 84: "Los Angeles",
            85: "Vancouver", 86: "Miami", 87: "Kansas City", 88: "Dallas",
            89: "Philadelphia", 90: "Houston", 91: "New York/New Jersey", 92: "Azteca, Mexico City",
            93: "Dallas", 94: "Seattle", 95: "Atlanta", 96: "Vancouver",
            97: "Boston", 98: "Los Angeles", 99: "Miami", 100: "Kansas City",
            101: "Dallas", 102: "Atlanta", 103: "Miami", 104: "New York/New Jersey"
        };

        const officialGroups = {
            1: 'A', 2: 'A', 25: 'A', 28: 'A', 53: 'A', 54: 'A',
            3: 'B', 8: 'B', 26: 'B', 27: 'B', 51: 'B', 52: 'B',
            5: 'C', 7: 'C', 29: 'C', 30: 'C', 49: 'C', 50: 'C',
            4: 'D', 6: 'D', 31: 'D', 32: 'D', 59: 'D', 60: 'D',
            9: 'E', 10: 'E', 33: 'E', 34: 'E', 55: 'E', 56: 'E',
            11: 'F', 12: 'F', 35: 'F', 36: 'F', 57: 'F', 58: 'F',
            15: 'G', 16: 'G', 39: 'G', 40: 'G', 63: 'G', 64: 'G',
            13: 'H', 14: 'H', 37: 'H', 38: 'H', 65: 'H', 66: 'H',
            17: 'I', 18: 'I', 41: 'I', 42: 'I', 61: 'I', 62: 'I',
            19: 'J', 20: 'J', 43: 'J', 44: 'J', 69: 'J', 70: 'J',
            23: 'K', 24: 'K', 47: 'K', 48: 'K', 71: 'K', 72: 'K',
            21: 'L', 22: 'L', 45: 'L', 46: 'L', 67: 'L', 68: 'L'
        };

        const knockoutMapping = {
            73: ["Group A 2nd", "Group B 2nd", "June 28"], 74: ["Group E Winner", "Group A/B/C/D/F 3rd", "June 29"],
            75: ["Group F Winner", "Group C 2nd", "June 29"], 76: ["Group C Winner", "Group F 2nd", "June 29"],
            77: ["Group I Winner", "Group C/D/F/G/H 3rd", "June 30"], 78: ["Group E 2nd", "Group I 2nd", "June 30"],
            79: ["Group A Winner", "Group C/E/F/H/I 3rd", "June 30"], 80: ["Group L Winner", "Group E/H/I/J/K 3rd", "July 1"],
            81: ["Group D Winner", "Group B/E/F/I/J 3rd", "July 1"], 82: ["Group G Winner", "Group A/E/H/I/J 3rd", "July 1"],
            83: ["Group K 2nd", "Group L 2nd", "July 2"], 84: ["Group H Winner", "Group J 2nd", "July 2"],
            85: ["Group B Winner", "Group E/F/G/I/J 3rd", "July 2"], 86: ["Group J Winner", "Group H 2nd", "July 3"],
            87: ["Group K Winner", "Group D/E/I/J/L 3rd", "July 3"], 88: ["Group D 2nd", "Group G 2nd", "July 3"],
            
            89: ["Winner Match 74", "Winner Match 77", "July 4"], 90: ["Winner Match 73", "Winner Match 75", "July 4"],
            91: ["Winner Match 76", "Winner Match 78", "July 5"], 92: ["Winner Match 79", "Winner Match 80", "July 5"],
            93: ["Winner Match 83", "Winner Match 84", "July 6"], 94: ["Winner Match 81", "Winner Match 82", "July 6"],
            95: ["Winner Match 86", "Winner Match 88", "July 7"], 96: ["Winner Match 85", "Winner Match 87", "July 7"],
            
            97: ["Winner Match 89", "Winner Match 90", "July 9"], 98: ["Winner Match 93", "Winner Match 94", "July 10"],
            99: ["Winner Match 91", "Winner Match 92", "July 11"], 100: ["Winner Match 95", "Winner Match 96", "July 11"],
            
            101: ["Winner Match 97", "Winner Match 98", "July 14"], 102: ["Winner Match 99", "Winner Match 100", "July 15"],
            
            103: ["Loser Match 101", "Loser Match 102", "July 18"], 104: ["Winner Match 101", "Winner Match 102", "July 19"]
        };

        // --- APP ENGINE ---
        const app = {
            state: { view: 'home', filter: 'all' },
            newsData: [], 
            
            // FALLBACK DATA
            fallbackData: [
                 {
                    id: 1,
                    title: "Bracketology: The 'Path of Death' in Group C",
                    category: "Bracket Analysis",
                    image: "https://images.unsplash.com/photo-1574629810360-7efbbe195018?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    date: "Oct 26, 2025",
                    snippet: "Why finishing second in Group C might be a tactical masterstroke.",
                    filename: "article-1.html",
                    content: `<p>Article Content...</p>`
                },
                {
                    id: 2,
                    title: "Player Watch: The Next Generation #10s",
                    category: "Scouting",
                    image: "https://images.unsplash.com/photo-1517466787929-bc90951d0974?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    date: "Oct 24, 2025",
                    snippet: "The classic playmaker is evolving.",
                    filename: "article-2.html",
                    content: `<p>Article Content...</p>`
                },
                {
                    id: 3,
                    title: "Tactics: Why 3-5-2 Will Dominate North America",
                    category: "Tactics",
                    image: "https://images.unsplash.com/photo-1522778119026-d647f0565c6a?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    date: "Oct 22, 2025",
                    snippet: "Heat, travel, and wide pitches.",
                    filename: "article-3.html",
                    content: `<p>Article Content...</p>`
                }
            ],

            init: () => {
                lucide.createIcons();
                app.startCountdown();
                app.generateMatches();
                app.fetchNews();
                
                document.getElementById('mobile-menu-btn').addEventListener('click', () => {
                    document.getElementById('mobile-menu').classList.toggle('hidden');
                });
            },

            // --- EXTERNAL CONTENT LOADING ---
            fetchNews: async () => {
                try {
                    const response = await fetch('news.json');
                    if (!response.ok) throw new Error("Could not fetch news manifest");
                    app.newsData = await response.json();
                } catch (e) {
                    console.log("Using internal fallback data (Preview Mode)");
                    app.newsData = app.fallbackData;
                }
                const loading = document.getElementById('home-news-loading');
                if(loading) loading.classList.add('hidden');
                document.getElementById('home-news-grid').classList.remove('hidden');
                app.renderNews();
            },

            loadArticleContent: async (filename, articleId) => {
                try {
                    if(!filename) throw new Error("No filename");
                    const response = await fetch(`articles/${filename}`);
                    if (!response.ok) throw new Error("External file not found");
                    return await response.text();
                } catch (e) {
                    const fallback = app.newsData.find(n => n.id === articleId);
                    if(fallback && fallback.content) return fallback.content;
                    return "<p>Article content could not be loaded.</p>";
                }
            },

            // Navigation Logic
            router: async (viewName, param = null) => {
                window.scrollTo({top: 0, behavior: 'smooth'});
                app.state.view = viewName;

                document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
                document.getElementById('mobile-menu').classList.add('hidden');

                if(viewName === 'article' && param) {
                    await app.renderArticle(param);
                    document.getElementById('article-view').classList.remove('hidden');
                } else {
                    document.getElementById(`${viewName}-view`).classList.remove('hidden');
                }
                
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    if(btn.dataset.target === viewName) {
                        btn.classList.remove('text-gray-300', 'bg-white/10');
                        btn.classList.add('bg-white', 'text-black');
                    } else {
                        btn.classList.add('text-gray-300', 'bg-white/10');
                        btn.classList.remove('bg-white', 'text-black');
                    }
                });
                if(viewName === 'tournament') app.renderMatches();
                lucide.createIcons();
            },

            // Render Full Article
            renderArticle: async (id) => {
                const article = app.newsData.find(n => n.id === id);
                if(!article) return;

                const contentDiv = document.getElementById('article-content');
                const loader = document.getElementById('article-loader');
                
                contentDiv.innerHTML = '';
                loader.classList.remove('hidden');

                const bodyHTML = await app.loadArticleContent(article.filename, article.id);

                loader.classList.add('hidden');
                contentDiv.innerHTML = `
                    <button onclick="app.router('news')" class="text-gray-400 hover:text-white mb-8 flex items-center gap-2 text-sm uppercase font-bold tracking-widest transition">
                        <i data-lucide="arrow-left" class="w-4 h-4"></i> Back to Analysis
                    </button>
                    
                    <div class="mb-8">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="bg-emerald-500/20 text-emerald-400 px-3 py-1 rounded text-xs font-bold uppercase tracking-wider border border-emerald-500/30">${article.category}</span>
                            <span class="text-gray-500 text-xs flex items-center gap-1"><i data-lucide="clock" class="w-3 h-3"></i> ${article.date}</span>
                        </div>
                        <h1 class="text-4xl md:text-6xl font-bold font-oswald mb-6 leading-tight">${article.title}</h1>
                    </div>

                    <div class="w-full h-[400px] mb-10 rounded-xl overflow-hidden relative border border-white/10">
                        <img src="${article.image}" class="w-full h-full object-cover">
                    </div>

                    <div class="prose prose-invert prose-lg max-w-none text-gray-300">
                        ${bodyHTML}
                    </div>
                `;
                lucide.createIcons();
            },

            // Render News Cards
            renderNews: () => {
                const homeGrid = document.getElementById('home-news-grid');
                const fullGrid = document.getElementById('full-news-grid');
                
                const createCard = (article) => `
                    <div onclick="app.router('article', ${article.id})" class="article-card group cursor-pointer bg-white/5 border border-white/10 rounded-xl overflow-hidden hover:border-emerald-500/50 transition relative">
                        <div class="h-48 overflow-hidden relative">
                            <img src="${article.image}" class="w-full h-full object-cover transition duration-700">
                            <div class="absolute top-2 left-2 bg-black/80 backdrop-blur text-white text-[10px] font-bold uppercase px-2 py-1 rounded border border-white/10">
                                ${article.category}
                            </div>
                        </div>
                        <div class="p-6">
                            <div class="text-gray-500 text-xs mb-2 flex items-center gap-2">
                                <i data-lucide="clock" class="w-3 h-3"></i> ${article.date}
                            </div>
                            <h3 class="text-xl font-bold font-oswald mb-2 leading-tight group-hover:text-emerald-400 transition">${article.title}</h3>
                            <p class="text-gray-400 text-sm line-clamp-2">${article.snippet}</p>
                            <div class="mt-4 flex items-center text-emerald-400 text-xs font-bold uppercase tracking-widest opacity-0 group-hover:opacity-100 transition transform translate-y-2 group-hover:translate-y-0">
                                Read Full Story <i data-lucide="arrow-right" class="w-3 h-3 ml-1"></i>
                            </div>
                        </div>
                    </div>
                `;
                if(homeGrid) homeGrid.innerHTML = app.newsData.slice(0, 3).map(createCard).join('');
                if(fullGrid) fullGrid.innerHTML = app.newsData.map(createCard).join('');
            },

            // Countdown Logic
            startCountdown: () => {
                const targetDate = new Date('June 11, 2026 12:00:00').getTime();
                setInterval(() => {
                    const now = new Date().getTime();
                    const distance = targetDate - now;
                    if (distance < 0) {
                        document.getElementById("countdown-container").innerHTML = "<div class='text-2xl font-bold text-emerald-400'>THE TOURNAMENT IS LIVE!</div>";
                        return;
                    }
                    document.getElementById("cd-days").innerText = String(Math.floor(distance / (1000 * 60 * 60 * 24))).padStart(2, '0');
                    document.getElementById("cd-hours").innerText = String(Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60))).padStart(2, '0');
                    document.getElementById("cd-minutes").innerText = String(Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60))).padStart(2, '0');
                    document.getElementById("cd-seconds").innerText = String(Math.floor((distance % (1000 * 60)) / 1000)).padStart(2, '0');
                }, 1000);
            },

            // --- BRACKET ENGINE (RESTORED FROM PREVIOUS VERSION) ---
            matches: [],
            
            generateMatches: () => {
                app.matches = []; // Clear existing

                // Helper for Pots
                function getPotTBD(matchIndex, side) {
                     const pattern = [[1, 2], [3, 4], [1, 3], [2, 4], [4, 1], [2, 3]];
                     const patternIndex = (matchIndex - 1) % 6; 
                     const pot = pattern[patternIndex][side === 'A' ? 0 : 1];
                     return `TBD <span class="text-gray-600 font-normal text-[10px] ml-1">(Pot ${pot})</span>`;
                }

                // 1. Group Stage Loop (1-72)
                for(let i=1; i<=72; i++) {
                    let date = `June ${11 + Math.floor((i-1)/4)}`;
                    let stad = officialVenues[i] || "TBD";
                    let groupLabel = officialGroups[i] || 'A'; 
                    
                    let tA = getPotTBD(i, 'A');
                    let tB = getPotTBD(i, 'B');

                    // Hardcoded Hosts Logic
                    if(i === 1) { tA = "Mexico"; tB = getPotTBD(i, 'B'); date = "June 11"; }
                    if(i === 3) { tA = "Canada"; tB = getPotTBD(i, 'B'); date = "June 12"; }
                    if(i === 4) { tA = "USA"; tB = getPotTBD(i, 'B'); date = "June 12"; }

                    app.matches.push({
                        id: i,
                        stage: "Group Stage",
                        group: groupLabel,
                        teamA: tA,
                        teamB: tB,
                        date: date,
                        stadium: stad
                    });
                }

                // 2. Knockout Loop (73-104)
                for(let i=73; i<=104; i++) {
                    const data = knockoutMapping[i];
                    let stageName = "Round of 32";
                    if(i > 88) stageName = "Round of 16";
                    if(i > 96) stageName = "Quarter-Final";
                    if(i > 100) stageName = "Semi-Final";
                    if(i === 103) stageName = "Bronze Final";
                    if(i === 104) stageName = "FINAL";

                    app.matches.push({
                        id: i,
                        stage: stageName,
                        teamA: data[0],
                        teamB: data[1],
                        date: data[2],
                        stadium: officialVenues[i] || "TBD"
                    });
                }
            },

            setFilter: (type) => {
                app.state.filter = type;
                // Update UI Buttons
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    if(btn.id === `btn-${type}`) {
                        btn.classList.remove('text-gray-500');
                        btn.classList.add('bg-white', 'text-black', 'shadow-[0_0_15px_rgba(255,255,255,0.2)]');
                    } else {
                        btn.classList.add('text-gray-500');
                        btn.classList.remove('bg-white', 'text-black', 'shadow-[0_0_15px_rgba(255,255,255,0.2)]');
                    }
                });
                app.renderMatches();
            },

            renderMatches: () => {
                const container = document.getElementById('matches-container');
                container.innerHTML = '';
                
                let data = app.matches;
                if(app.state.filter === 'group') data = data.filter(m => m.id <= 72);
                if(app.state.filter === 'knockout') data = data.filter(m => m.id > 72);

                // Render Calendar View Special Case
                if(app.state.filter === 'calendar') {
                    container.className = "flex flex-col gap-8 max-w-4xl mx-auto";
                    const dates = [...new Set(app.matches.map(m => m.date))];
                    
                    dates.slice(0, 10).forEach(date => { // Show first 10 days
                        const dayMatches = app.matches.filter(m => m.date === date);
                        const section = document.createElement('div');
                        section.className = "pl-6 border-l border-white/20 relative pb-8";
                        section.innerHTML = `
                            <div class="absolute -left-[5px] top-0 w-2.5 h-2.5 bg-emerald-500 rounded-full"></div>
                            <h3 class="text-xl font-bold mb-4 text-emerald-400 font-mono uppercase">${date}</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                ${dayMatches.map(m => app.getMatchCard(m)).join('')}
                            </div>
                        `;
                        container.appendChild(section);
                    });
                } else {
                    // Standard Grid
                    container.className = "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4";
                    data.forEach(m => {
                        container.innerHTML += app.getMatchCard(m);
                    });
                }
                lucide.createIcons();
            },

            getMatchCard: (match) => {
                const isGroup = match.stage === 'Group Stage';
                const groupBadge = isGroup ? `<span class="bg-emerald-500/10 text-emerald-400 text-[10px] px-1.5 py-0.5 rounded ml-2 border border-emerald-500/20">GRP ${match.group}</span>` : '';
                
                const rawTeamA = match.teamA.replace(/<[^>]*>?/gm, '');
                const rawTeamB = match.teamB.replace(/<[^>]*>?/gm, '');
                const searchQuery = encodeURIComponent(`FIFA World Cup 2026 Match ${match.id} ${rawTeamA} vs ${rawTeamB} tickets`);
                const searchUrl = `https://www.google.com/search?q=${searchQuery}`;

                return `
                <div class="bg-white/5 border border-white/10 rounded p-4 hover:bg-white/10 transition group relative overflow-hidden">
                    <div class="flex justify-between items-center mb-4 text-xs uppercase tracking-wider">
                        <div class="flex items-center text-gray-500 font-bold">
                            Match ${match.id} ${groupBadge}
                        </div>
                        <span class="text-gray-400">${match.date}</span>
                    </div>
                    
                    <div class="space-y-3 mb-4">
                        <div class="flex items-center">
                            ${getFlagHTML(match.teamA)}
                            <span class="font-bold text-gray-200 text-sm md:text-base">${match.teamA}</span>
                        </div>
                        <div class="flex items-center">
                            ${getFlagHTML(match.teamB)}
                            <span class="font-bold text-gray-200 text-sm md:text-base">${match.teamB}</span>
                        </div>
                    </div>

                    <div class="border-t border-white/10 pt-3 flex justify-between items-center text-xs text-gray-500">
                        <div class="truncate max-w-[50%] flex items-center gap-1">
                            <i data-lucide="map-pin" class="w-3 h-3"></i> ${match.stadium}
                        </div>
                        <a href="${searchUrl}" target="_blank" class="text-emerald-400 hover:text-white transition font-bold uppercase flex items-center gap-1">
                            Find Tickets <i data-lucide="external-link" class="w-3 h-3"></i>
                        </a>
                    </div>
                </div>`;
            }
        };

        window.addEventListener('DOMContentLoaded', app.init);
    </script>
</body>
</html>